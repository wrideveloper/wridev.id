---
import { Icon } from "astro-icon/components";
import { navItems } from "~/data/navigation";
import { t, language } from "~/i18n";
import { getLocalizedPath } from "~/utils/i18n";
import LanguageSwitcher from "~/components/sections/globals/components/language-switcher.svelte";

const tr = t(Astro.currentLocale as keyof typeof language);
const currentLocale = Astro.currentLocale || "en";

const translatedNavItems = [
    { name: tr.nav.home, href: "/" },
    { name: tr.nav.talents, href: "/talents" },
    { name: tr.nav.about, href: "/about-us" },
    { name: tr.nav.articles, href: "/articles" },
];

const currentPath = Astro.url.pathname;

const isLinkActive = (href: string) => {
    const localizeRootPath = getLocalizedPath("/", currentLocale);
    if (href === localizeRootPath && currentPath === localizeRootPath)
        return true;
    if (href !== localizeRootPath && currentPath.startsWith(href)) return true;
    return false;
};
---

<nav
    class="fixed w-full bg-wri-white/65 backdrop-blur-xl py-4 px-4 md:py-10 md:px-30 flex justify-between items-center z-99"
>
    <a
        href={getLocalizedPath("/", currentLocale)}
        class="flex items-center gap-2 z-50"
    >
        <img
            src="/assets/wri-logo.webp"
            alt="Workshop Riset Informatika Logo"
            class="h-8 md:h-10"
        />
    </a>

    <ul class="hidden md:flex gap-0">
        {
            translatedNavItems.map((item) => {
                const localizedHref = getLocalizedPath(
                    item.href,
                    currentLocale,
                );
                const isActive = isLinkActive(localizedHref);
                return (
                    <li>
                        <a
                            href={localizedHref}
                            class={`font-medium transition-colors duration-200 px-6 text-base ${
                                isActive
                                    ? "text-black border-b-3 border-wri-blue pb-4"
                                    : "text-gray-500 border-b-2 border-wri-blue/50 pb-4.25 hover:text-black hover:border-b-3 hover:border-wri-blue hover:pb-4"
                            }`}
                        >
                            {item.name}
                        </a>
                    </li>
                );
            })
        }
    </ul>

    <div class="flex items-center gap-4 z-50">
        <LanguageSwitcher
            client:load
            currentLocale={currentLocale}
            currentPath={currentPath}
        />

        <button
            id="menu-toggle"
            class="md:hidden text-gray-800 hover:text-wri-blue focus:outline-none relative w-8 h-8"
            aria-label="Toggle Menu"
        >
            <div
                id="icon-menu"
                class="absolute inset-0 flex items-center justify-center"
            >
                <Icon name="ph:list" class="w-8 h-8" />
            </div>
            <div
                id="icon-close"
                class="absolute inset-0 flex items-center justify-center opacity-0 scale-0"
            >
                <Icon name="ph:x" class="w-8 h-8" />
            </div>
        </button>
    </div>

    <div
        id="mobile-menu"
        class="h-svh fixed inset-0 bg-wri-white/98 backdrop-blur-xl z-40 md:hidden flex flex-col justify-center items-center gap-8 invisible"
    >
        <ul class="flex flex-col items-center gap-6">
            {
                translatedNavItems.map((item) => {
                    const localizedHref = getLocalizedPath(
                        item.href,
                        currentLocale,
                    );
                    const isActive = isLinkActive(localizedHref);
                    return (
                        <li class="mobile-nav-item opacity-0 translate-y-4">
                            <a
                                href={localizedHref}
                                class={`text-2xl font-medium transition-colors duration-200 ${
                                    isActive
                                        ? "text-wri-blue font-bold"
                                        : "text-gray-600 hover:text-wri-blue"
                                }`}
                            >
                                {item.name}
                            </a>
                        </li>
                    );
                })
            }
        </ul>
    </div>
</nav>

<script>
    import gsap from "gsap";

    const menuToggle = document.getElementById("menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
    const iconMenu = document.getElementById("icon-menu");
    const iconClose = document.getElementById("icon-close");
    const navItems = document.querySelectorAll(".mobile-nav-item");

    if (menuToggle && mobileMenu && iconMenu && iconClose) {
        gsap.set(mobileMenu, { yPercent: -100, autoAlpha: 1 });

        const tl = gsap.timeline({ paused: true, reversed: true });

        tl.to(mobileMenu, {
            yPercent: 0,
            duration: 0.6,
            ease: "power3.inOut",
        })

            .to(
                iconMenu,
                {
                    rotation: 180,
                    scale: 0,
                    opacity: 0,
                    duration: 0.3,
                },
                "<",
            )
            .to(
                iconClose,
                {
                    rotation: 0,
                    scale: 1,
                    opacity: 1,
                    duration: 0.3,
                },
                "<0.1",
            )

            .to(
                navItems,
                {
                    y: 0,
                    opacity: 1,
                    duration: 0.4,
                    stagger: 0.1,
                    ease: "back.out(1.7)",
                },
                "-=0.3",
            );

        menuToggle.addEventListener("click", () => {
            if (tl.reversed()) {
                tl.play();
                document.body.style.overflow = "hidden";
            } else {
                tl.reverse();
                document.body.style.overflow = "auto";
            }
        });

        const menuLinks = mobileMenu.querySelectorAll("a");
        menuLinks.forEach((link) => {
            link.addEventListener("click", () => {
                tl.reverse();
                document.body.style.overflow = "auto";
            });
        });
    }
</script>
