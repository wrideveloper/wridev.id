---
import { Icon } from "astro-icon/components";
---

<div
    id="cursor"
    class="fixed top-0 left-0 w-7 h-7 bg-wri-blue/20 backdrop-blur-[2px] rounded-full pointer-events-none z-100 opacity-0 flex justify-center items-center overflow-visible"
>
    <Icon
        id="cursor-icon"
        name="ph:arrow-up-right-bold"
        class="w-3 h-3 text-wri-blue opacity-0 absolute z-10"
    />

    <div
        id="cursor-text-container"
        class="absolute w-[200%] h-[200%] -left-1/2 -top-1/2 rounded-full opacity-0"
    >
        <div id="circle-text" class="w-full h-full relative"></div>
    </div>

    <div
        id="cursor-nametag"
        class="absolute left-3 top-3 bg-blue-500 text-white text-sm font-medium px-3 py-1.5 rounded-r-lg rounded-bl-lg whitespace-nowrap opacity-0 scale-90 origin-top-left shadow-lg z-20 translate-y-6 translate-x-4.5"
    >
        <span id="nametag-text"></span>
    </div>
</div>

<script>
    import gsap from "gsap";

    const cursor = document.getElementById("cursor");
    const cursorIcon = document.getElementById("cursor-icon");
    const cursorTextContainer = document.getElementById(
        "cursor-text-container",
    );
    const circleText = document.getElementById("circle-text");

    const cursorNametag = document.getElementById("cursor-nametag");
    const nametagText = document.getElementById("nametag-text");

    if (circleText) {
        const text = "See m ore   See m ore  ";
        const chars = text.split("");
        const deg = 360 / chars.length;
        const radius = 23;

        chars.forEach((char, i) => {
            const span = document.createElement("span");
            span.innerText = char;
            span.className =
                "absolute top-1/2 left-1/2 origin-[0_0] text-[9px] font-medium  wri-italic from-wri-blue to-wri-blue/45 select-none";
            span.style.transform = `rotate(${i * deg}deg) translate(0, -${radius}px)`;
            circleText.appendChild(span);
        });
    }

    if (cursorTextContainer) {
        gsap.to(cursorTextContainer, {
            rotation: 360,
            duration: 8,
            repeat: -1,
            ease: "linear",
        });
    }

    if (cursor && cursorIcon && cursorTextContainer && cursorNametag) {
        gsap.set(cursor, { xPercent: -50, yPercent: -50 });

        const xTo = gsap.quickTo(cursor, "x", {
            duration: 0.35,
            ease: "power2.out",
        });
        const yTo = gsap.quickTo(cursor, "y", {
            duration: 0.35,
            ease: "power2.out",
        });

        let hoverState = "default";

        window.addEventListener("mousemove", (e) => {
            gsap.to(cursor, { opacity: 1, duration: 0.5 });
            xTo(e.clientX);
            yTo(e.clientY);

            const target = e.target as HTMLElement;
            const miniclass = target.closest(".miniclass");
            const articles = target.closest(".articles");
            const nameTarget = target.closest("[data-namecursor]");

            if (miniclass || articles) {
                hoverState = "readmore";

                gsap.to(cursor, { scale: 3, duration: 0.3 });
                gsap.to(cursorIcon, { opacity: 1, duration: 0.3 });
                gsap.to(cursorTextContainer, { opacity: 1, duration: 0.3 });

                gsap.to(cursorNametag, {
                    opacity: 0,
                    scale: 0.8,
                    duration: 0.2,
                });
            } else if (nameTarget) {
                const text = nameTarget.getAttribute("data-namecursor");
                if (nametagText && nametagText.innerText !== text) {
                    nametagText.innerText = text || "Info";
                }

                hoverState = "talentname";

                gsap.to(cursor, { scale: 1, duration: 0.3 });
                gsap.to(cursorIcon, { opacity: 0, duration: 0.3 });
                gsap.to(cursorTextContainer, { opacity: 0, duration: 0.3 });

                gsap.to(cursorNametag, {
                    opacity: 1,
                    scale: 1,
                    duration: 0.3,
                    ease: "back.out(1.7)",
                    overwrite: true,
                });
            } else {
                if (hoverState !== "default") {
                    hoverState = "default";

                    gsap.to(cursor, { scale: 1, duration: 0.3 });
                    gsap.to(cursorIcon, { opacity: 0, duration: 0.3 });
                    gsap.to(cursorTextContainer, { opacity: 0, duration: 0.3 });

                    gsap.to(cursorNametag, {
                        opacity: 0,
                        scale: 0.8,
                        duration: 0.2,
                        overwrite: true,
                        onComplete: () => {
                            if (nametagText) nametagText.innerText = "";
                        },
                    });
                }
            }
        });
    }
</script>
