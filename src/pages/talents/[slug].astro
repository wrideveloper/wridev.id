---
export const prerender = false
import Layout from "~/layouts/Layout.astro"
import ProfileSection from "~/components/sections/profile-page/profile-section.astro";
import {fetchWithCache} from "../../utils/cache"

const {slug} = Astro.params;

// default ttl will be using the ttl from .env
const response = await fetchWithCache(`${import.meta.env.WORKER_URL}/talent/${slug}`, import.meta.env.TTL);
// const response = await fetch(`${import.meta.env.WORKER_URL}/talent/${slug}`);

if (!response.ok) {
return Astro.redirect('../404');
}

const rawData = await response.json();

const talent_data = {
  ...rawData,
  contacts: typeof rawData.contacts === 'string' ? JSON.parse(rawData.contacts) : rawData.contacts,
  proficiencies: typeof rawData.proficiencies === 'string' ? JSON.parse(rawData.proficiencies) : rawData.proficiencies,
  availabilities: typeof rawData.availabilities === 'string' ? JSON.parse(rawData.availabilities) : rawData.availabilities,
  metrics: rawData.metrics || { github: null, figma: null }
};

---

<Layout>
  <style is:global>
    nav {
      display: none !important;
    }
  </style>
  <main class="pt-16 w-full min-h-screen">
    <ProfileSection talent_data={talent_data} />
  </main>
</Layout>
